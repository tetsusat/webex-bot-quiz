{"version":3,"sources":["activities.js"],"names":["OLDER","NEWER","MID","INITIAL","ACTIVITY_TYPES","REPLY","EDIT","REACTION","REACTION_SELF","ROOT","CREATE","TOMBSTONE","DELETE","REPLY_EDIT","REACTION_SUMMARY","REACTION_SELF_SUMMARY","ADD","getActivityType","activity","activityType","parent","type","verb","getPublishedDate","Date","published","getTime","isNewer","activity1","activity2","sortActivitiesByPublishedDate","activities","getParentId","id","isRootActivity","act","isReplyActivity","isEditActivity","isCreateActivity","isDeleteActivity","sanitizeActivity","final","reaction","reactionSelf","replies","getIsActivityOrphaned","getIsReplyEditActivity","parentId","parentActivity","determineActivityType","initialType","isReplyEditActivity","createRootActivity","createReplyActivity","replyAct","replyParent","createEditActivity","editActivity","editActParentObj","parentAct","joinedEditAct","editParent","object","createReplyEditActivity","parentReplyAct","joinedReplyEditActivity"],"mappings":"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","sourcesContent":["import {sortBy} from 'lodash';\n\nexport const OLDER = 'older';\nexport const NEWER = 'newer';\nexport const MID = 'mid';\nexport const INITIAL = 'initial';\n\nexport const ACTIVITY_TYPES = {\n  REPLY: 'REPLY',\n  EDIT: 'EDIT',\n  REACTION: 'REACTION',\n  REACTION_SELF: 'REACTION_SELF',\n  ROOT: 'ROOT',\n  CREATE: 'CREATE',\n  TOMBSTONE: 'TOMBSTONE',\n  DELETE: 'DELETE',\n  REPLY_EDIT: 'REPLY_EDIT'\n};\n\nconst REPLY = 'reply';\nconst EDIT = 'edit';\nconst REACTION_SUMMARY = 'reactionSummary';\nconst REACTION_SELF_SUMMARY = 'reactionSelfSummary';\nconst CREATE = 'create';\nconst TOMBSTONE = 'tombstone';\nconst DELETE = 'delete';\nconst ADD = 'add';\n\nexport const getActivityType = (activity) => {\n  if (activity.activityType === REPLY) {\n    return ACTIVITY_TYPES.REPLY;\n  }\n  if (activity.parent && activity.parent.type === EDIT) {\n    return ACTIVITY_TYPES.EDIT;\n  }\n  if (activity.verb === ADD || activity.type === REACTION_SUMMARY) {\n    return ACTIVITY_TYPES.REACTION;\n  }\n  if (activity.type === REACTION_SELF_SUMMARY) {\n    return ACTIVITY_TYPES.REACTION_SELF;\n  }\n  if (activity.verb === CREATE) {\n    return ACTIVITY_TYPES.CREATE;\n  }\n  if (activity.verb === TOMBSTONE) {\n    return ACTIVITY_TYPES.TOMBSTONE;\n  }\n  if (activity.verb === DELETE) {\n    return ACTIVITY_TYPES.DELETE;\n  }\n\n  return ACTIVITY_TYPES.ROOT;\n};\n\nexport const getPublishedDate = (activity = {}) => new Date(activity.published).getTime();\n\n/**\n * @param {Object} activity1\n * @param {Object} activity2\n * @returns {boolean} true if first activity is newer than second\n */\nexport const isNewer = (activity1, activity2) => getPublishedDate(activity1) > getPublishedDate(activity2);\n\nexport const sortActivitiesByPublishedDate = (activities) => sortBy(activities, (activity) => getPublishedDate(activity));\n\nexport const getParentId = (activity) => activity && activity.parent && activity.parent.id;\n\nexport const isRootActivity = (act) => getActivityType(act) === ACTIVITY_TYPES.ROOT;\nexport const isReplyActivity = (act) => getActivityType(act) === ACTIVITY_TYPES.REPLY;\nexport const isEditActivity = (act) => getActivityType(act) === ACTIVITY_TYPES.EDIT;\nexport const isCreateActivity = (act) => getActivityType(act) === ACTIVITY_TYPES.CREATE;\nexport const isDeleteActivity = (act) => getActivityType(act) === ACTIVITY_TYPES.DELETE;\n\nexport const sanitizeActivity = (activity) => {\n  const final = {...activity};\n\n  final.reaction = activity.reaction || {};\n  final.reactionSelf = activity.reactionSelf || {};\n\n  // replies will be spread in order beneath parent, no need to include on final objects\n  delete final.replies;\n\n  return final;\n};\n\nexport const getIsActivityOrphaned = (activity, activities) => activity.parent && activity.parent.id && !activities[activity.parent.id];\n\nconst getIsReplyEditActivity = (activity, activities) => {\n  const parentId = activity.parent.id;\n  const parentActivity = activities[parentId];\n\n  return parentActivity && isReplyActivity(parentActivity);\n};\n\nexport const determineActivityType = (activity, activities) => {\n  const initialType = getActivityType(activity);\n\n  // edits to a reply, while they are replies themselves, appear in every way as edits\n  // the only way to dermine their status as an edited reply is to find the original reply\n  if (initialType === ACTIVITY_TYPES.EDIT) {\n    const isReplyEditActivity = getIsReplyEditActivity(activity, activities);\n\n    return isReplyEditActivity ? ACTIVITY_TYPES.REPLY_EDIT : initialType;\n  }\n\n  return initialType;\n};\n\nexport const createRootActivity = (activity) => activity;\n\nexport const createReplyActivity = (activity) => {\n  const replyAct = {\n    ...activity,\n    replyParent: activity.parent\n  };\n\n  return replyAct;\n};\n\nexport const createEditActivity = (editActivity, activities) => {\n  const editActParentObj = editActivity.parent;\n  const parentId = editActParentObj.id;\n  const parentAct = activities[parentId];\n\n  const joinedEditAct = {\n    ...parentAct,\n    id: editActivity.id,\n    parent: editActParentObj,\n    editParent: editActParentObj,\n    object: editActivity.object,\n    published: editActivity.published\n  };\n\n  return joinedEditAct;\n};\n\n// takes an edit activity whose parent is a reply activity\nexport const createReplyEditActivity = (editActivity, activities) => {\n  const editActParentObj = editActivity.parent;\n  const parentId = editActParentObj.id;\n  const parentReplyAct = activities[parentId];\n\n  const joinedReplyEditActivity = {\n    ...parentReplyAct,\n    id: editActivity.id,\n    parent: editActParentObj,\n    editParent: editActParentObj,\n    replyParent: parentReplyAct.parent,\n    object: editActivity.object,\n    published: editActivity.published\n  };\n\n  return joinedReplyEditActivity;\n};\n"]}