{"version":3,"sources":["webex-core.js"],"names":["interceptors","WebexTrackingIdInterceptor","create","RequestEventInterceptor","RateLimitInterceptor","RequestLoggerInterceptor","process","env","ENABLE_NETWORK_LOGGING","ENABLE_VERBOSE_NETWORK_LOGGING","undefined","ResponseLoggerInterceptor","RequestTimingInterceptor","ServiceInterceptor","UserAgentInterceptor","WebexUserAgentInterceptor","AuthInterceptor","KmsDryErrorInterceptor","PayloadTransformerInterceptor","ConversationInterceptor","RedirectInterceptor","HttpStatusInterceptor","error","WebexHttpError","NetworkTimingInterceptor","EmbargoInterceptor","DefaultOptionsInterceptor","preInterceptors","postInterceptors","WebexCore","AmpState","extend","version","children","internal","WebexInternalCore","constructor","attrs","options","credentials","supertoken","access_token","forEach","path","val","bearerValidator","trim","derived","boundedStorage","deps","fn","unboundedStorage","ready","loaded","_children","reduce","name","session","config","type","default","request","setOnce","sessionId","refresh","transform","direction","object","predicates","payloadTransformer","filter","p","ctx","webex","all","map","test","then","shouldTransform","extract","target","data","d","Boolean","promise","alias","applyNamedTransform","resolve","rest","unshift","args","transforms","tx","getWindow","window","initialize","trigger","onLoaded","stopListening","nextTick","listenToAndRun","onReady","prototype","key","listenTo","addInterceptor","ints","interceptor","push","includes","json","uuid","v4","setConfig","newConfig","token","split","length","console","warn","replace","info","inspect","depth","util","serialize","props","logout","refresh_token","onBeforeLogout","reverse","plugin","catch","err","logger","clear","invalidate","authorization","measure","metrics","sendUnstructured","upload","feature","getFeature","s3UploadsSupported","file","reject","Error","phases","finalize","method","body","uploadProtocol","withCredentials","headers","shunt","EventEmitter","_uploadPhaseInitialize","_uploadPhaseUpload","_uploadPhaseFinalize","res","debug","_uploadApplySession","opts","phaseOptions","phaseKey","startsWith","substr","NODE_ENV","on","event","total","retry","registerPlugin","registerInternalPlugin"],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {EventEmitter} from 'events';\nimport util from 'util';\n\nimport {proxyEvents, retry, transferEvents} from '@webex/common';\nimport {HttpStatusInterceptor, defaults as requestDefaults} from '@webex/http-core';\nimport {defaultsDeep, get, isFunction, isString, last, merge, omit, set, unset} from 'lodash';\nimport AmpState from 'ampersand-state';\nimport uuid from 'uuid';\n\nimport AuthInterceptor from './interceptors/auth';\nimport NetworkTimingInterceptor from './interceptors/network-timing';\nimport PayloadTransformerInterceptor from './interceptors/payload-transformer';\nimport RedirectInterceptor from './interceptors/redirect';\nimport RequestEventInterceptor from './interceptors/request-event';\nimport RequestLoggerInterceptor from './interceptors/request-logger';\nimport RequestTimingInterceptor from './interceptors/request-timing';\nimport ResponseLoggerInterceptor from './interceptors/response-logger';\nimport WebexHttpError from './lib/webex-http-error';\nimport UserAgentInterceptor from './interceptors/user-agent';\nimport WebexTrackingIdInterceptor from './interceptors/webex-tracking-id';\nimport WebexUserAgentInterceptor from './interceptors/webex-user-agent';\nimport RateLimitInterceptor from './interceptors/rate-limit';\nimport EmbargoInterceptor from './interceptors/embargo';\nimport DefaultOptionsInterceptor from './interceptors/default-options';\nimport config from './config';\nimport {makeWebexStore} from './lib/storage';\nimport mixinWebexCorePlugins from './lib/webex-core-plugin-mixin';\nimport mixinWebexInternalCorePlugins from './lib/webex-internal-core-plugin-mixin';\nimport WebexInternalCore from './webex-internal-core';\n\n// TODO replace the Interceptor.create with Reflect.construct (\n// Interceptor.create exists because new was really hard to call on an array of\n// constructors)\nconst interceptors = {\n  WebexTrackingIdInterceptor: WebexTrackingIdInterceptor.create,\n  RequestEventInterceptor: RequestEventInterceptor.create,\n  RateLimitInterceptor: RateLimitInterceptor.create,\n  /* eslint-disable no-extra-parens */\n  RequestLoggerInterceptor: (process.env.ENABLE_NETWORK_LOGGING || process.env.ENABLE_VERBOSE_NETWORK_LOGGING) ? RequestLoggerInterceptor.create : undefined,\n  ResponseLoggerInterceptor: (process.env.ENABLE_NETWORK_LOGGING || process.env.ENABLE_VERBOSE_NETWORK_LOGGING) ? ResponseLoggerInterceptor.create : undefined,\n  /* eslint-enable no-extra-parens */\n  RequestTimingInterceptor: RequestTimingInterceptor.create,\n  ServiceInterceptor: undefined,\n  UserAgentInterceptor: UserAgentInterceptor.create,\n  WebexUserAgentInterceptor: WebexUserAgentInterceptor.create,\n  AuthInterceptor: AuthInterceptor.create,\n  KmsDryErrorInterceptor: undefined,\n  PayloadTransformerInterceptor: PayloadTransformerInterceptor.create,\n  ConversationInterceptor: undefined,\n  RedirectInterceptor: RedirectInterceptor.create,\n  HttpStatusInterceptor() {\n    return HttpStatusInterceptor.create({\n      error: WebexHttpError\n    });\n  },\n  NetworkTimingInterceptor: NetworkTimingInterceptor.create,\n  EmbargoInterceptor: EmbargoInterceptor.create,\n  DefaultOptionsInterceptor: DefaultOptionsInterceptor.create\n};\n\nconst preInterceptors = [\n  'ResponseLoggerInterceptor',\n  'RequestTimingInterceptor',\n  'RequestEventInterceptor',\n  'WebexTrackingIdInterceptor',\n  'RateLimitInterceptor'\n];\n\nconst postInterceptors = [\n  'HttpStatusInterceptor',\n  'NetworkTimingInterceptor',\n  'EmbargoInterceptor',\n  'RequestLoggerInterceptor',\n  'RateLimitInterceptor'\n];\n\n/**\n * @class\n */\nconst WebexCore = AmpState.extend({\n  version: PACKAGE_VERSION,\n\n  children: {\n    internal: WebexInternalCore\n  },\n\n  constructor(attrs = {}, options) {\n    if (typeof attrs === 'string') {\n      attrs = {\n        credentials: {\n          supertoken: {\n            // eslint-disable-next-line camelcase\n            access_token: attrs\n          }\n        }\n      };\n    }\n    else {\n      // Reminder: order is important here\n      [\n        'credentials.authorization',\n        'authorization',\n        'credentials.supertoken.supertoken',\n        'supertoken',\n        'access_token',\n        'credentials.authorization.supertoken'\n      ].forEach((path) => {\n        const val = get(attrs, path);\n\n        if (val) {\n          unset(attrs, path);\n          set(attrs, 'credentials.supertoken', val);\n        }\n      });\n\n      [\n        'credentials',\n        'credentials.authorization'\n      ]\n        .forEach((path) => {\n          const val = get(attrs, path);\n\n          if (typeof val === 'string') {\n            unset(attrs, path);\n            set(attrs, 'credentials.supertoken', val);\n          }\n        });\n\n      if (typeof get(attrs, 'credentials.access_token') === 'string') {\n        // Send access_token to get validated and corrected and then set it\n        set(attrs, 'credentials.access_token', this.bearerValidator(get(attrs, 'credentials.access_token').trim()));\n\n        set(attrs, 'credentials.supertoken', attrs.credentials);\n      }\n    }\n\n    return Reflect.apply(AmpState, this, [attrs, options]);\n  },\n\n  derived: {\n    boundedStorage: {\n      deps: [],\n      fn() {\n        return makeWebexStore('bounded', this);\n      }\n    },\n    unboundedStorage: {\n      deps: [],\n      fn() {\n        return makeWebexStore('unbounded', this);\n      }\n    },\n    ready: {\n      deps: ['loaded', 'internal.ready'],\n      fn() {\n        return this.loaded && Object.keys(this._children).reduce((ready, name) => ready && this[name] && this[name].ready !== false, true);\n      }\n    }\n  },\n\n  session: {\n    config: {\n      type: 'object'\n    },\n    /**\n     * When true, indicates that the initial load from the storage layer is\n     * complete\n     * @instance\n     * @memberof WebexCore\n     * @type {boolean}\n     */\n    loaded: {\n      default: false,\n      type: 'boolean'\n    },\n    request: {\n      setOnce: true,\n      // It's supposed to be a function, but that's not a type defined in\n      // Ampersand\n      type: 'any'\n    },\n    sessionId: {\n      setOnce: true,\n      type: 'string'\n    }\n  },\n\n  /**\n   * @instance\n   * @memberof WebexCore\n   * @param {[type]} args\n   * @returns {[type]}\n   */\n  refresh(...args) {\n    return this.credentials.refresh(...args);\n  },\n\n  /**\n   * Applies the directionally appropriate transforms to the specified object\n   * @param {string} direction\n   * @param {Object} object\n   * @returns {Promise}\n   */\n  transform(direction, object) {\n    const predicates = this.config.payloadTransformer.predicates.filter(\n      (p) => !p.direction || p.direction === direction\n    );\n    const ctx = {\n      webex: this\n    };\n\n    return Promise.all(predicates.map((p) => p.test(ctx, object)\n      .then((shouldTransform) => {\n        if (!shouldTransform) {\n          return undefined;\n        }\n\n        return p.extract(object)\n          // eslint-disable-next-line max-nested-callbacks\n          .then((target) => ({\n            name: p.name,\n            target\n          }));\n      })))\n      .then((data) => data\n        .filter((d) => Boolean(d))\n        // eslint-disable-next-line max-nested-callbacks\n        .reduce((promise, {name, target, alias}) => promise.then(() => {\n          if (alias) {\n            return this.applyNamedTransform(direction, alias, target);\n          }\n\n          return this.applyNamedTransform(direction, name, target);\n        }), Promise.resolve()))\n      .then(() => object);\n  },\n\n  /**\n   * Applies the directionally appropriate transform to the specified parameters\n   * @param {string} direction\n   * @param {Object} ctx\n   * @param {string} name\n   * @returns {Promise}\n   */\n  applyNamedTransform(direction, ctx, name, ...rest) {\n    if (isString(ctx)) {\n      rest.unshift(name);\n      name = ctx;\n      ctx = {\n        webex: this,\n        transform: (...args) => this.applyNamedTransform(direction, ctx, ...args)\n      };\n    }\n\n    const transforms = ctx.webex.config.payloadTransformer.transforms.filter(\n      (tx) => tx.name === name && (!tx.direction || tx.direction === direction)\n    );\n\n    // too many implicit returns on the same line is difficult to interpret\n    // eslint-disable-next-line arrow-body-style\n    return transforms.reduce((promise, tx) => promise.then(() => {\n      if (tx.alias) {\n        return ctx.transform(tx.alias, ...rest);\n      }\n\n      return Promise.resolve(tx.fn(ctx, ...rest));\n    }), Promise.resolve())\n      .then(() => last(rest));\n  },\n\n  /**\n   * @private\n   * @returns {Window}\n   */\n  getWindow() {\n    // eslint-disable-next-line\n    return window;\n  },\n\n  /**\n   * Initializer\n   *\n   * @emits WebexCore#loaded\n   * @emits WebexCore#ready\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} attrs\n   * @returns {WebexCore}\n   */\n  initialize(attrs = {}) {\n    this.config = merge({}, config, attrs.config);\n\n\n    // There's some unfortunateness with the way {@link AmpersandState#children}\n    // get initialized. We'll fire the change:config event so that\n    // {@link WebexPlugin#initialize()} can use\n    // `this.listenToOnce(parent, 'change:config', () => {});` to act on config\n    // during initialization\n    this.trigger('change:config');\n\n    const onLoaded = () => {\n      if (this.loaded) {\n        /**\n         * Fires when all data has been loaded from the storage layer\n         * @event loaded\n         * @instance\n         * @memberof WebexCore\n         */\n        this.trigger('loaded');\n\n        this.stopListening(this, 'change:loaded', onLoaded);\n      }\n    };\n\n    // This needs to run on nextTick or we'll never be able to wire up listeners\n    process.nextTick(() => {\n      this.listenToAndRun(this, 'change:loaded', onLoaded);\n    });\n\n    const onReady = () => {\n      if (this.ready) {\n        /**\n         * Fires when all plugins have fully initialized\n         * @event ready\n         * @instance\n         * @memberof WebexCore\n         */\n        this.trigger('ready');\n\n        this.stopListening(this, 'change:ready', onReady);\n      }\n    };\n\n    // This needs to run on nextTick or we'll never be able to wire up listeners\n    process.nextTick(() => {\n      this.listenToAndRun(this, 'change:ready', onReady);\n    });\n\n    // Make nested events propagate in a consistent manner\n    Object.keys(this.constructor.prototype._children).forEach((key) => {\n      this.listenTo(this[key], 'change', (...args) => {\n        args.unshift(`change:${key}`);\n        this.trigger(...args);\n      });\n    });\n\n    const addInterceptor = (ints, key) => {\n      const interceptor = interceptors[key];\n\n      if (!isFunction(interceptor)) {\n        return ints;\n      }\n\n      ints.push(Reflect.apply(interceptor, this, []));\n\n      return ints;\n    };\n\n    let ints = [];\n\n    ints = preInterceptors.reduce(addInterceptor, ints);\n    ints = Object.keys(interceptors)\n      .filter((key) => !(preInterceptors.includes(key) || postInterceptors.includes(key)))\n      .reduce(addInterceptor, ints);\n    ints = postInterceptors.reduce(addInterceptor, ints);\n\n    this.request = requestDefaults({\n      json: true,\n      interceptors: ints\n    });\n\n    let sessionId = `${get(this, 'config.trackingIdPrefix', 'webex-js-sdk')}_${get(this, 'config.trackingIdBase', uuid.v4())}`;\n\n    if (get(this, 'config.trackingIdSuffix')) {\n      sessionId += `_${get(this, 'config.trackingIdSuffix')}`;\n    }\n\n    this.sessionId = sessionId;\n  },\n\n  /**\n   * setConfig\n   *\n   * Allows updating config\n   *\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} newConfig\n   * @returns {null}\n   */\n  setConfig(newConfig = {}) {\n    this.config = merge({}, this.config, newConfig);\n  },\n\n  /**\n   *\n   * Check if access token is correctly formated and correct if it's not\n   * Warn user if token string has errors in it\n   * @param {string} token\n   * @returns {string}\n   */\n  bearerValidator(token) {\n    if (token.includes('Bearer') && token.split(' ').length - 1 === 0) {\n      console.warn(\n        `Your access token does not have a space between 'Bearer' and the token, please add a space to it or replace it with this already fixed version:\\n\\n${token.replace('Bearer', 'Bearer ').replace(/\\s+/g, ' ')}`\n      );\n      console.info(\"Tip: You don't need to add 'Bearer' to the access_token field. The token by itself is fine\");\n\n      return token.replace('Bearer', 'Bearer ').replace(/\\s+/g, ' ');\n    }\n    // Allow elseIf return\n    // eslint-disable-next-line  no-else-return\n    else if (token.split(' ').length - 1 > 1) {\n      console.warn(\n        `Your access token has ${token.split(' ').length - 2} too many spaces, please use this format:\\n\\n${token.replace(/\\s+/g, ' ')}`\n      );\n      console.info(\"Tip: You don't need to add 'Bearer' to the access_token field, the token by itself is fine\");\n\n      return token.replace(/\\s+/g, ' ');\n    }\n\n    return token.replace(/\\s+/g, ' '); // Clean it anyway (just in case)\n  },\n\n  /**\n   * @instance\n   * @memberof WebexPlugin\n   * @param {number} depth\n   * @private\n   * @returns {Object}\n   */\n  inspect(depth) {\n    return util.inspect(omit(this.serialize({\n      props: true,\n      session: true,\n      derived: true\n    }), 'boundedStorage', 'unboundedStorage', 'request', 'config'), {depth});\n  },\n\n  /**\n   * Invokes all `onBeforeLogout` handlers in the scope of their plugin, clears\n   * all stores, and revokes the access token\n   * Note: If you're using the sdk in a server environment, you may be more\n   * interested in {@link `webex.internal.mercury.disconnect()`| Mercury#disconnect()}\n   * and {@link `webex.internal.device.unregister()`|Device#unregister()}\n   * or {@link `webex.phone.unregister()`|Phone#unregister}\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} options Passed as the first argument to all\n   * `onBeforeLogout` handlers\n   * @returns {Promise}\n   */\n  logout(options, ...rest) {\n    // prefer the refresh token, but for clients that don't have one, fallback\n    // to the access token\n    const token = this.credentials.supertoken && (this.credentials.supertoken.refresh_token || this.credentials.supertoken.access_token);\n\n    options = Object.assign({token}, options);\n\n    // onBeforeLogout should be executed in the opposite order in which handlers\n    // were registered. In that way, wdm unregister() will be above mercury\n    // disconnect(), but disconnect() will execute first.\n    // eslint-disable-next-line arrow-body-style\n    return this.config.onBeforeLogout.reverse().reduce((promise, {plugin, fn}) => promise.then(() => {\n      return Promise.resolve(Reflect.apply(fn, this[plugin] || this.internal[plugin], [options, ...rest]))\n        // eslint-disable-next-line max-nested-callbacks\n        .catch((err) => {\n          this.logger.warn(`onBeforeLogout from plugin ${plugin}: failed`, err);\n        });\n    }), Promise.resolve())\n      .then(() => Promise.all([\n        this.boundedStorage.clear(),\n        this.unboundedStorage.clear()\n      ]))\n      .then(() => this.credentials.invalidate(...rest))\n      .then(() => this.authorization && this.authorization.logout && this.authorization.logout(options, ...rest))\n      .then(() => this.trigger('client:logout'));\n  },\n\n  /**\n   * General purpose wrapper to submit metrics via the metrics plugin (if the\n   * metrics plugin is installed)\n   * @instance\n   * @memberof WebexCore\n   * @returns {Promise}\n   */\n  measure(...args) {\n    if (this.metrics) {\n      return this.metrics.sendUnstructured(...args);\n    }\n\n    return Promise.resolve();\n  },\n\n  async upload(options) {\n    let s3UploadsSupported;\n\n    if (this.internal && this.internal.feature) {\n      s3UploadsSupported = await this.internal.feature.getFeature('developer', 'files-s3');\n    }\n    if (!options.file) {\n      return Promise.reject(new Error('`options.file` is required'));\n    }\n\n    options.phases = options.phases || {};\n    options.phases.initialize = options.phases.initialize || {};\n    options.phases.upload = options.phases.upload || {};\n    options.phases.finalize = options.phases.finalize || {};\n\n    defaultsDeep(options.phases.initialize, {\n      method: 'POST',\n      body: {\n        uploadProtocol: s3UploadsSupported ? 'content-length' : null\n      }\n    }, omit(options, 'file', 'phases'));\n\n    defaultsDeep(options.phases.upload, {\n      method: 'PUT',\n      json: false,\n      withCredentials: false,\n      body: options.file,\n      headers: {\n        'x-trans-id': uuid.v4(),\n        authorization: undefined\n      }\n    });\n\n    defaultsDeep(options.phases.finalize, {\n      method: 'POST'\n    }, omit(options, 'file', 'phases'));\n\n    const shunt = new EventEmitter();\n\n    const promise = this._uploadPhaseInitialize(options)\n      .then(() => {\n        const p = this._uploadPhaseUpload(options);\n\n        transferEvents('progress', p, shunt);\n\n        return p;\n      })\n      .then((...args) => this._uploadPhaseFinalize(options, ...args))\n      .then((res) => ({...res.body, ...res.headers}));\n\n    proxyEvents(shunt, promise);\n\n    return promise;\n  },\n\n  _uploadPhaseInitialize: function _uploadPhaseInitialize(options) {\n    this.logger.debug('client: initiating upload session');\n\n    return this.request(options.phases.initialize)\n      .then((...args) => this._uploadApplySession(options, ...args))\n      .then((res) => {\n        this.logger.debug('client: initiated upload session');\n\n        return res;\n      });\n  },\n\n  _uploadApplySession(options, res) {\n    const session = res.body;\n\n    ['upload', 'finalize'].reduce((opts, key) => {\n      opts[key] = Object.keys(opts[key]).reduce((phaseOptions, phaseKey) => {\n        if (phaseKey.startsWith('$')) {\n          phaseOptions[phaseKey.substr(1)] = phaseOptions[phaseKey](session);\n          Reflect.deleteProperty(phaseOptions, phaseKey);\n        }\n\n        return phaseOptions;\n      }, opts[key]);\n\n      return opts;\n    }, options.phases);\n  },\n\n  @retry\n  _uploadPhaseUpload(options) {\n    this.logger.debug('client: uploading file');\n\n    const promise = this.request(options.phases.upload)\n      .then((res) => {\n        this.logger.debug('client: uploaded file');\n\n        return res;\n      });\n\n    proxyEvents(options.phases.upload.upload, promise);\n\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV === 'test') {\n      promise.on('progress', (event) => {\n        this.logger.info('upload progress', event.loaded, event.total);\n      });\n    }\n\n    return promise;\n  },\n\n  _uploadPhaseFinalize: function _uploadPhaseFinalize(options) {\n    this.logger.debug('client: finalizing upload session');\n\n    return this.request(options.phases.finalize)\n      .then((res) => {\n        this.logger.debug('client: finalized upload session');\n\n        return res;\n      });\n  }\n});\n\nWebexCore.version = PACKAGE_VERSION;\n\nmixinWebexInternalCorePlugins(WebexInternalCore, config, interceptors);\nmixinWebexCorePlugins(WebexCore, config, interceptors);\n\nexport default WebexCore;\n\n/**\n * @method registerPlugin\n * @param {string} name\n * @param {function} constructor\n * @param {Object} options\n * @param {Array<string>} options.proxies\n * @param {Object} options.interceptors\n * @returns {null}\n */\nexport function registerPlugin(name, constructor, options) {\n  WebexCore.registerPlugin(name, constructor, options);\n}\n\n/**\n * Registers plugins used by internal products that do not talk to public APIs.\n * @method registerInternalPlugin\n * @param {string} name\n * @param {function} constructor\n * @param {Object} options\n * @param {Object} options.interceptors\n * @private\n * @returns {null}\n */\nexport function registerInternalPlugin(name, constructor, options) {\n  WebexInternalCore.registerPlugin(name, constructor, options);\n}\n"]}