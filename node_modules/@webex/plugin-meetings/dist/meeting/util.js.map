{"version":3,"sources":["util.js"],"names":["MeetingUtil","parseLocusJoin","response","parsed","locus","body","mediaConnections","locusUrl","url","locusId","split","pop","selfId","self","id","forEach","mediaConnection","mediaId","remoteUpdateAudioVideo","audioMuted","videoMuted","meeting","reject","ParameterError","localMedias","Media","generateLocalMedias","Metrics","postEvent","event","eventType","MEDIA_REQUEST","meetingRequest","remoteAudioVideoToggle","deviceUrl","correlationId","then","MEDIA_RESPONSE","locusInfo","onFullLocus","checkShare","wirelessShare","isSharing","stopShare","resolve","hasOwner","info","owner","isOwnerSelf","isPinOrGuest","err","errorCode","INTENT_TO_JOIN","joinMeeting","options","LOCAL_JOIN_REQUEST","sipUri","roapMessage","resourceId","moderator","pin","moveToResource","preferTranscoding","res","LOCUS_JOIN_RESPONSE","data","trigger","LOCI_UPDATE","trackingId","headers","trackingid","cleanUp","statsAnalyzer","stopAnalyzer","closeLocalStream","closeLocalShare","closeRemoteTracks","closePeerConnections","unsetLocalVideoTrack","unsetLocalShareTrack","unsetRemoteTracks","unsetPeerConnections","cleanMQAInterval","roap","stop","roapSeq","leaveMeeting","defaultOptions","leaveOptions","moveMeeting","catch","LoggerProxy","logger","error","declineMeeting","reason","isGuestUnjoined","parsedLocus","guest","state","_JOINED_","joinMeetingOptions","setCorrelationId","PIN_COLLECTED","setLocus","meetingInfo","PIN_PROMPT","IntentToJoinError","JoinMeetingError","updateTransceiver","meetingOptions","type","sendTrack","receiveTrack","track","transceiver","peerConnection","previousMediaDirection","undefined","meetingId","remoteQualityLevel","mediaProperties","enableRtx","config","sendRoapMediaRequest","sdp","e","sender","replaceTrack","validateOptions","sendVideo","sendAudio","sendShare","localStream","localShare","getTrack","videoTrack","audioTrack","stream","audioTracks","videoTracks","getAudioTracks","getVideoTracks","length","getModeratorFromLocusInfo","getPolicyFromLocusInfo","policy","canUserLock","joined","LOCK_CONTROL_LOCK","LOCK_STATUS_UNLOCKED","canUserUnlock","LOCK_CONTROL_UNLOCK","LOCK_STATUS_LOCKED","canUserRecord","RECORDING_CONTROL_START","canUserPause","RECORDING_CONTROL_PAUSE","canUserResume","RECORDING_CONTROL_RESUME","canUserStop","RECORDING_CONTROL_STOP","startRecording","request","recordMeeting","recording","paused","PermissionError","pauseRecording","resumeRecording","stopRecording","lockMeeting","actions","canLock","lock","unlockMeeting","canUnlock","startInternalStats","internalStats","useConfig","senders","correlate","history","onEvent","kind","stat","Trigger","file","function","EVENT_TRIGGERS","MEETING_MEDIA_LOCAL_STARTED","mediaType","AUDIO","SENDING_MEDIA_START","SENDING_MEDIA_STOP","onData","VIDEO","SHARE","SENDING_SHARE_START","SENDING_SHARE_STOP","receivers","MEETING_MEDIA_REMOTE_STARTED","RECEIVING_MEDIA_START","RECEIVING_MEDIA_STOP","StatsUtil","generateOptions","STATS","CONFIG","WebRTCStats","attrs"],"mappings":"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","sourcesContent":["import {isEmpty} from 'lodash';\n\nimport StatsUtil from '../stats/util';\nimport Metrics from '../metrics';\nimport {eventType, trigger, mediaType} from '../metrics/config';\nimport Media from '../media';\nimport LoggerProxy from '../common/logs/logger-proxy';\nimport WebRTCStats from '../stats/index';\nimport {\n  INTENT_TO_JOIN,\n  _JOINED_,\n  STATS,\n  EVENT_TRIGGERS\n} from '../constants';\nimport Trigger from '../common/events/trigger-proxy';\nimport IntentToJoinError from '../common/errors/intent-to-join';\nimport JoinMeetingError from '../common/errors/join-meeting';\nimport ParameterError from '../common/errors/parameter';\nimport PermissionError from '../common/errors/permission';\n\nconst MeetingUtil = {};\n\nMeetingUtil.parseLocusJoin = (response) => {\n  const parsed = {};\n\n  // First todo: add check for existance\n  parsed.locus = response.body.locus;\n  parsed.mediaConnections = response.body.mediaConnections;\n  parsed.locusUrl = parsed.locus.url;\n  parsed.locusId = parsed.locus.url.split('/').pop();\n  parsed.selfId = parsed.locus.self.id;\n\n  // we need mediaId before making roap calls\n  parsed.mediaConnections.forEach((mediaConnection) => {\n    if (mediaConnection.mediaId) {\n      parsed.mediaId = mediaConnection.mediaId;\n    }\n  });\n\n  return parsed;\n};\n\nMeetingUtil.remoteUpdateAudioVideo = (audioMuted, videoMuted, meeting) => {\n  if (!meeting) {\n    return Promise.reject(new ParameterError('You need a meeting object.'));\n  }\n  const localMedias = Media.generateLocalMedias(meeting.mediaId, audioMuted, videoMuted);\n\n  if (isEmpty(localMedias)) {\n    return Promise.reject(new ParameterError('You need a media id on the meeting to change remote audio.'));\n  }\n\n  Metrics.postEvent({event: eventType.MEDIA_REQUEST, meeting});\n\n  return meeting.meetingRequest.remoteAudioVideoToggle({\n    locusUrl: meeting.locusUrl,\n    selfId: meeting.selfId,\n    localMedias,\n    deviceUrl: meeting.deviceUrl,\n    correlationId: meeting.correlationId\n  }).then((response) => {\n    Metrics.postEvent({event: eventType.MEDIA_RESPONSE, meeting});\n    meeting.locusInfo.onFullLocus(response.body.locus);\n  });\n};\n\nMeetingUtil.checkShare = (meeting) => {\n  if ((meeting.wirelessShare && meeting.isSharing) || meeting.isSharing) {\n    return meeting.stopShare();\n  }\n\n  return Promise.resolve();\n};\n\nMeetingUtil.hasOwner = (info) => info && info.owner;\n\nMeetingUtil.isOwnerSelf = (owner, selfId) => owner === selfId;\n\nMeetingUtil.isPinOrGuest = (err) => {\n  if (err && err.body && err.body.errorCode === INTENT_TO_JOIN) {\n    return true;\n  }\n\n  return false;\n};\n\nMeetingUtil.joinMeeting = (meeting, options) => {\n  if (!meeting) {\n    return Promise.reject(new ParameterError('You need a meeting object.'));\n  }\n\n  Metrics.postEvent({event: eventType.LOCAL_JOIN_REQUEST, meeting});\n\n  // eslint-disable-next-line no-warning-comments\n  // TODO: check if the meeting is in JOINING state\n  // if Joining state termintate the request as user might click multiple times\n  return meeting.meetingRequest\n    .joinMeeting({\n      sipUri: meeting.sipUri,\n      deviceUrl: meeting.deviceUrl,\n      locusUrl: meeting.locusUrl,\n      correlationId: meeting.id,\n      roapMessage: options.roapMessage,\n      resourceId: options.resourceId || null,\n      moderator: options.moderator,\n      pin: options.pin,\n      moveToResource: options.moveToResource,\n      preferTranscoding: options.preferTranscoding\n    })\n    .then((res) => {\n      Metrics.postEvent({\n        event: eventType.LOCUS_JOIN_RESPONSE,\n        meeting,\n        data: {\n          trigger: trigger.LOCI_UPDATE,\n          locus: res.body.locus,\n          trackingId: res.headers.trackingid\n        }\n      });\n\n      return MeetingUtil.parseLocusJoin(res);\n    });\n};\n\nMeetingUtil.cleanUp = (meeting) => {\n  // make sure we send last metrics before we close the peerconnection\n  if (meeting.statsAnalyzer) meeting.statsAnalyzer.stopAnalyzer();\n\n  return meeting.closeLocalStream()\n    .then(() => meeting.closeLocalShare())\n    .then(() => meeting.closeRemoteTracks())\n    .then(() => meeting.closePeerConnections())\n    .then(() => {\n      meeting.unsetLocalVideoTrack();\n      meeting.unsetLocalShareTrack();\n      meeting.unsetRemoteTracks();\n      meeting.unsetPeerConnections();\n      meeting.cleanMQAInterval();\n    })\n    .then(() => meeting.roap.stop(meeting.correlationId, meeting.roapSeq));\n};\n\n// by default will leave on meeting's resourceId\n// if you explicity want it not to leave on resource id, pass\n// {resourceId: null}\n// TODO: chris, you can modify this however you want\nMeetingUtil.leaveMeeting = (meeting, options = {}) => {\n  const defaultOptions = {\n    locusUrl: meeting.locusUrl,\n    selfId: meeting.selfId,\n    correlationId: meeting.correlationId,\n    resourceId: meeting.resourceId,\n    deviceUrl: meeting.deviceUrl\n  };\n\n  const leaveOptions = {...defaultOptions, ...options};\n\n  return meeting.meetingRequest\n    .leaveMeeting(leaveOptions)\n    .then((response) => {\n      if (response && response.body && response.body.locus) { // && !options.moveMeeting) {\n        meeting.locusInfo.onFullLocus(response.body.locus);\n      }\n\n      return Promise.resolve();\n    })\n    .then(() => {\n      if (options.moveMeeting) {\n        return Promise.resolve();\n      }\n\n      return MeetingUtil.cleanUp(meeting);\n    })\n    .catch((err) => {\n      LoggerProxy.logger.error(\n        `Meeting:util#leaveMeeting --> An error occured while trying to leave meeting with an id of ${\n          meeting.id\n        }, error: ${err}`\n      );\n\n      return Promise.reject(err);\n    });\n};\nMeetingUtil.declineMeeting = (meeting, reason) =>\n  meeting.meetingRequest.declineMeeting({\n    locusUrl: meeting.locusUrl,\n    deviceUrl: meeting.deviceUrl,\n    reason\n  });\n\nMeetingUtil.isGuestUnjoined = (locusInfo) =>\n  locusInfo.parsedLocus && locusInfo.parsedLocus.self && locusInfo.parsedLocus.self.guest && locusInfo.parsedLocus.self.state !== _JOINED_;\n\nMeetingUtil.joinMeetingOptions = (meeting, options = {}) => {\n  meeting.resourceId = meeting.resourceId || options.resourceId;\n  meeting.setCorrelationId(meeting.id);\n\n  if (options.pin) {\n    Metrics.postEvent({\n      event: eventType.PIN_COLLECTED,\n      meeting\n    });\n  }\n\n  // normal join meeting, scenario A, D\n  return MeetingUtil.joinMeeting(meeting, options)\n    .then((response) => {\n      meeting.setLocus(response);\n\n      return Promise.resolve(response);\n    })\n    .catch((err) => {\n      // joining a claimed PMR that is not my own, scenario B\n      if (MeetingUtil.isPinOrGuest(err)) {\n        if (MeetingUtil.hasOwner(meeting.meetingInfo)) {\n          return MeetingUtil.joinMeeting(meeting, options).then((response) => {\n            meeting.setLocus(response);\n\n            return Promise.resolve();\n          });\n        }\n\n        Metrics.postEvent({\n          event: eventType.PIN_PROMPT,\n          meeting\n        });\n\n        // request host pin or non host for unclaimed PMR, start of Scenario C\n        // see https://sqbu-github.cisco.com/WebExSquared/locus/wiki/Locus-Lobby-and--IVR-Feature\n        return Promise.reject(new IntentToJoinError('Error Joining Meeting', err));\n      }\n      LoggerProxy.logger.error('Meeting:util#joinMeetingOptions --> Error joining the call, ', err);\n\n      return Promise.reject(new JoinMeetingError(options, 'Error Joining Meeting', err));\n    });\n};\n\nMeetingUtil.updateTransceiver = (options, meetingOptions) => {\n  const {\n    type,\n    sendTrack,\n    receiveTrack,\n    track,\n    transceiver,\n    peerConnection,\n    previousMediaDirection\n  } = options;\n\n  if ((sendTrack !== undefined && sendTrack !== previousMediaDirection.sendTrack) ||\n  (receiveTrack !== undefined && receiveTrack !== previousMediaDirection.receiveTrack)) {\n    return Media.updateTransceiver({\n      meetingId: meetingOptions.meeting.id,\n      remoteQualityLevel: meetingOptions.mediaProperties.remoteQualityLevel,\n      enableRtx: meetingOptions.meeting.config.enableRtx\n    }, peerConnection, transceiver,\n    {\n      track,\n      type,\n      receiveTrack,\n      sendTrack\n    })\n      .then(() => meetingOptions.meeting.roap\n        .sendRoapMediaRequest({\n          sdp: meetingOptions.mediaProperties.peerConnection.sdp,\n          roapSeq: meetingOptions.roapSeq,\n          meeting: meetingOptions.meeting // or can pass meeting ID\n        }))\n      .catch((e) => {\n        LoggerProxy.logger.error(`Meeting:util#updateTransceiver --> Error updating the ${type} streams with error: ${e}`);\n      });\n  } if (track) {\n    transceiver.sender.replaceTrack(track);\n\n    return Promise.resolve();\n  }\n\n  return Promise.reject(new ParameterError('update Failed: please pass valid parameter'));\n};\n\nMeetingUtil.validateOptions = (options) => {\n  const {\n    sendVideo, sendAudio, sendShare, localStream, localShare\n  } = options;\n\n  if (sendVideo && !MeetingUtil.getTrack(localStream).videoTrack) {\n    return Promise.reject(new ParameterError('please pass valid video streams'));\n  }\n\n  if (sendAudio && !MeetingUtil.getTrack(localStream).audioTrack) {\n    return Promise.reject(new ParameterError('please pass valid audio streams'));\n  }\n\n  if (sendShare && !MeetingUtil.getTrack(localShare).videoTrack) {\n    return Promise.reject(new ParameterError('please pass valid share streams'));\n  }\n\n  return Promise.resolve();\n};\n\nMeetingUtil.getTrack = (stream) => {\n  let audioTrack = null;\n  let videoTrack = null;\n  let audioTracks = null;\n  let videoTracks = null;\n\n  if (!stream) {\n    return {audioTrack: null, videoTrack: null};\n  }\n  if (stream.getAudioTracks) {\n    audioTracks = stream.getAudioTracks();\n  }\n  if (stream.getVideoTracks) {\n    videoTracks = stream.getVideoTracks();\n  }\n\n  if (audioTracks && audioTracks.length > 0) {\n    [audioTrack] = audioTracks;\n  }\n\n  if (videoTracks && videoTracks.length > 0) {\n    [videoTrack] = videoTracks;\n  }\n\n  return {audioTrack, videoTrack};\n};\n\nMeetingUtil.getModeratorFromLocusInfo = (locusInfo) =>\n  locusInfo &&\n  locusInfo.parsedLocus &&\n  locusInfo.parsedLocus.info &&\n  locusInfo.parsedLocus.info &&\n  locusInfo.parsedLocus.info.moderator;\n\nMeetingUtil.getPolicyFromLocusInfo = (locusInfo) =>\n  locusInfo &&\n  locusInfo.parsedLocus &&\n  locusInfo.parsedLocus.info &&\n  locusInfo.parsedLocus.info &&\n  locusInfo.parsedLocus.info.policy;\n\nMeetingUtil.canUserLock = (moderator, joined) => {\n  if (moderator.LOCK_CONTROL_LOCK && joined.LOCK_STATUS_UNLOCKED) {\n    return true;\n  }\n\n  return false;\n};\n\nMeetingUtil.canUserUnlock = (moderator, joined) => {\n  if (moderator.LOCK_CONTROL_UNLOCK && joined.LOCK_STATUS_LOCKED) {\n    return true;\n  }\n\n  return false;\n};\n\nMeetingUtil.canUserRecord = (moderator) => moderator.RECORDING_CONTROL_START;\n\nMeetingUtil.canUserPause = (moderator) => moderator.RECORDING_CONTROL_PAUSE;\n\nMeetingUtil.canUserResume = (moderator) => moderator.RECORDING_CONTROL_RESUME;\n\nMeetingUtil.canUserStop = (moderator) => moderator.RECORDING_CONTROL_STOP;\n\nMeetingUtil.startRecording = (request, locusUrl, locusInfo) => {\n  const moderator = MeetingUtil.getModeratorFromLocusInfo(locusInfo);\n\n  if (moderator && MeetingUtil.canUserRecord(moderator)) {\n    return request.recordMeeting({locusUrl, recording: true, paused: false});\n  }\n\n  return Promise.reject(new PermissionError('Start recording not allowed, due to moderator property.'));\n};\n\nMeetingUtil.pauseRecording = (request, locusUrl, locusInfo) => {\n  const moderator = MeetingUtil.getModeratorFromLocusInfo(locusInfo);\n\n  if (moderator && MeetingUtil.canUserPause(moderator)) {\n    return request.recordMeeting({locusUrl, recording: true, paused: true});\n  }\n\n  return Promise.reject(new PermissionError('Pause recording not allowed, due to moderator property.'));\n};\n\nMeetingUtil.resumeRecording = (request, locusUrl, locusInfo) => {\n  const moderator = MeetingUtil.getModeratorFromLocusInfo(locusInfo);\n\n  if (moderator && MeetingUtil.canUserResume(moderator)) {\n    return request.recordMeeting({locusUrl, recording: true, paused: false});\n  }\n\n  return Promise.reject(new PermissionError('Resume recording not allowed, due to moderator property.'));\n};\n\nMeetingUtil.stopRecording = (request, locusUrl, locusInfo) => {\n  const moderator = MeetingUtil.getModeratorFromLocusInfo(locusInfo);\n\n  if (moderator && MeetingUtil.canUserStop(moderator)) {\n    return request.recordMeeting({locusUrl, recording: false, paused: false});\n  }\n\n  return Promise.reject(new PermissionError('Stop recording not allowed, due to moderator property.'));\n};\n\nMeetingUtil.lockMeeting = (actions, request, locusUrl) => {\n  if (actions && actions.canLock) {\n    return request.lockMeeting({locusUrl, lock: true});\n  }\n\n  return Promise.reject(new PermissionError('Lock not allowed, due to joined property.'));\n};\n\nMeetingUtil.unlockMeeting = (actions, request, locusUrl) => {\n  if (actions && actions.canUnlock) {\n    return request.lockMeeting({locusUrl, lock: false});\n  }\n\n  return Promise.reject(new PermissionError('Unlock not allowed, due to joined property.'));\n};\n\nMeetingUtil.startInternalStats = (meeting) => {\n  if (!meeting.internalStats) {\n    const options = {\n      useConfig: true,\n      senders: [\n        {\n          id: 'mainAudio',\n          correlate: 'audio',\n          history: true,\n          onEvent: (event) => {\n            // TODO: we don't need checks like this since it comes from the transceiver\n            // refactor event linkage to use callbacks instead of events\n            if (event.kind === 'audio' && event.stat === 'bytesSent') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_LOCAL_STARTED,\n                {\n                  type: mediaType.AUDIO\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.SENDING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.AUDIO\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesSent') {\n              Metrics.postEvent({\n                event: eventType.SENDING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.AUDIO\n                }\n              });\n            }\n          },\n          onData: () => {}\n        },\n        {\n          id: 'mainVideo',\n          correlate: 'video',\n          history: true,\n          onEvent: (event) => {\n            if (event.kind === 'video' && event.stat === 'bytesSent') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_LOCAL_STARTED,\n                {\n                  type: mediaType.VIDEO\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.SENDING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.VIDEO\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesSent') {\n              Metrics.postEvent({\n                event: eventType.SENDING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.VIDEO\n                }\n              });\n            }\n          },\n          onData: () => {}\n        },\n        {\n          id: 'mainShare',\n          correlate: 'video',\n          onEvent: (event) => {\n            if (event.kind === 'share' && event.stat === 'bytesSent') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_LOCAL_STARTED,\n                {\n                  type: mediaType.SHARE\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.SENDING_SHARE_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.SHARE\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesSent') {\n              Metrics.postEvent({\n                event: eventType.SENDING_SHARE_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.SHARE\n                }\n              });\n            }\n          },\n          onData: () => {}\n        }\n      ],\n      receivers: [\n        {\n          id: 'mainAudio',\n          correlate: 'audio',\n          history: true,\n          onEvent: (event) => {\n            if (event.kind === 'audio' && event.stat === 'bytesReceived') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_REMOTE_STARTED,\n                {\n                  type: mediaType.AUDIO\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.AUDIO\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesReceived') {\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.AUDIO\n                }\n              });\n            }\n          },\n          onData: () => {}\n        },\n        {\n          id: 'mainVideo',\n          correlate: 'video',\n          history: true,\n          onEvent: (event) => {\n            if (event.kind === 'video' && event.stat === 'bytesReceived') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_REMOTE_STARTED,\n                {\n                  type: mediaType.VIDEO\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.VIDEO\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesReceived') {\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.VIDEO\n                }\n              });\n            }\n          },\n          onData: () => {}\n        },\n        {\n          id: 'mainShare',\n          correlate: 'video',\n          onEvent: (event) => {\n            if (event.kind === 'share' && event.stat === 'bytesReceived') {\n              Trigger.trigger(\n                meeting,\n                {\n                  file: 'meeting/util',\n                  function: 'startInternalStats'\n                },\n                EVENT_TRIGGERS.MEETING_MEDIA_REMOTE_STARTED,\n                {\n                  type: mediaType.SHARE\n                }\n              );\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_START,\n                meeting,\n                data: {\n                  mediaType: mediaType.SHARE\n                }\n              });\n            }\n            else if (event.stop && event.stat === 'bytesReceived') {\n              Metrics.postEvent({\n                event: eventType.RECEIVING_MEDIA_STOP,\n                meeting,\n                data: {\n                  mediaType: mediaType.SHARE\n                }\n              });\n            }\n          },\n          onData: () => {}\n        }\n      ]\n    };\n\n    StatsUtil.generateOptions(options, STATS.CONFIG, meeting);\n\n    options.config = STATS.CONFIG;\n\n    // pass the attrs and options for the webex instance\n    meeting.internalStats = new WebRTCStats(meeting.attrs, meeting.options, options);\n  }\n\n  return meeting.internalStats;\n};\n\nexport default MeetingUtil;\n"]}