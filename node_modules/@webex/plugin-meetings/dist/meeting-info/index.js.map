{"version":3,"sources":["index.js"],"names":["MeetingInfo","attrs","options","MEETINGS","meetingInfoRequest","MeetingInfoRequest","meetingInfoCollection","MeetingInfoCollection","id","get","info","set","fetchMeetingInfo","then","body","setMeetingInfo","sipMeetingUri","meetingLink","catch","error","LoggerProxy","logger","reject","destination","type","MeetingInfoUtil","generateOptions","webex","fetchInfoOptions","requestFetchInfo","_MEETING_LINK_","convertLinkToSip","_SIP_URI_","StatelessWebexPlugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA;;AAEA;;AAKA;;AAEA;;AACA;;AACA;;;;;;AAEA;;;IAGqBA,W;;;;;AAGnB;;;;;AAKA,uBAAYC,KAAZ,EAAmBC,OAAnB,EAA4B;AAAA;;AAAA;AAC1B,8BAAM,EAAN,EAAUA,OAAV;AACA;;;;;;;;AAF0B,4FAPhBC,mBAOgB;AAS1B,UAAKC,kBAAL,GAA0B,IAAIC,gBAAJ,CAAuB,EAAvB,EAA2BH,OAA3B,CAA1B;AACA;;;;;;;;AAOA,UAAKI,qBAAL,GAA6B,IAAIC,mBAAJ,EAA7B;AAjB0B;AAkB3B;AAED;;;;;;;;;;mCAMeC,E,EAAI;AACjB,aAAO,KAAKF,qBAAL,CAA2BG,GAA3B,CAA+BD,EAA/B,CAAP;AACD;AAED;;;;;;;;;;mCAOeA,E,EAAIE,I,EAAM;AACvB,WAAKJ,qBAAL,CAA2BK,GAA3B,CAA+BH,EAA/B,EAAmCE,IAAnC;AACD;AAED;;;;;;;;;;qCAOiBR,O,EAAS;AAAA;;AACxB,aAAO,KAAKE,kBAAL,CAAwBQ,gBAAxB,CAAyCV,OAAzC,EAAkDW,IAAlD,CAAuD,UAACH,IAAD,EAAU;AACtE,YAAIA,IAAI,IAAIA,IAAI,CAACI,IAAjB,EAAuB;AACrB,UAAA,MAAI,CAACC,cAAL,CAAoBL,IAAI,CAACI,IAAL,CAAUE,aAAV,IAA2BN,IAAI,CAACI,IAAL,CAAUG,WAAzD,EAAsEP,IAAI,CAACI,IAA3E;AACD;;AAED,eAAOJ,IAAP;AACD,OANM,EAMJQ,KANI,CAME,UAACC,KAAD,EAAW;AAClBC,6BAAYC,MAAZ,CAAmBF,KAAnB,oDAAqEA,KAArE;;AAEA,eAAO,iBAAQG,MAAR,CAAeH,KAAf,CAAP;AACD,OAVM,CAAP;AAWD;AAED;;;;;;;;;;;qCAQiBI,W,EAAaC,I,EAAM;AAClC,aAAOC,cAAgBC,eAAhB,CAAgC;AACrCH,QAAAA,WAAW,EAAXA,WADqC;AAErCC,QAAAA,IAAI,EAAJA,IAFqC;AAGrCG,QAAAA,KAAK,EAAE,KAAKA;AAHyB,OAAhC,CAAP;AAKD;AAED;;;;;;;;;;;qCAQiBJ,W,EAA0B;AAAA;;AAAA,UAAbC,IAAa,uEAAN,IAAM;AACzC,aAAO,KAAKI,gBAAL,CAAsBL,WAAtB,EAAmCC,IAAnC,EAAyCX,IAAzC,CAA8C,UAACX,OAAD;AAAA,eACrD;AACE,UAAA,MAAI,CAAC2B,gBAAL,CAAsB3B,OAAtB,EAA+BgB,KAA/B,CAAqC,UAACC,KAAD,EAAW;AAChD;AACE,gBAAIjB,OAAO,CAACsB,IAAR,KAAiBM,yBAArB,EAAqC;AACrC;AACE,qBAAO,MAAI,CAACD,gBAAL,CAAsB,MAAI,CAACD,gBAAL,CAAsBH,cAAgBM,gBAAhB,CAAiCR,WAAjC,CAAtB,EAAqES,oBAArE,CAAtB,CAAP;AACD;;AAED,mBAAO,iBAAQV,MAAR,CAAeH,KAAf,CAAP;AACD,WARD;AAFmD;AAAA,OAA9C,CAAP;AAWD;;;EA1GsCc,+B","sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {StatelessWebexPlugin} from '@webex/webex-core';\n\nimport {\n  MEETINGS,\n  _MEETING_LINK_,\n  _SIP_URI_\n} from '../constants';\nimport LoggerProxy from '../common/logs/logger-proxy';\n\nimport MeetingInfoCollection from './collection';\nimport MeetingInfoRequest from './request';\nimport MeetingInfoUtil from './util';\n\n/**\n * @class MeetingInfo\n */\nexport default class MeetingInfo extends StatelessWebexPlugin {\n  namespace = MEETINGS;\n\n  /**\n   *\n   * @param {Object} attrs\n   * @param {Object} options\n   */\n  constructor(attrs, options) {\n    super({}, options);\n    /**\n     * The meeting info request server interface\n     * @instance\n     * @type {Object}\n     * @private\n     * @memberof MeetingInfo\n    */\n    this.meetingInfoRequest = new MeetingInfoRequest({}, options);\n    /**\n     * The meeting information collection interface\n     * @instance\n     * @type {Object}\n     * @private\n     * @memberof MeetingInfo\n    */\n    this.meetingInfoCollection = new MeetingInfoCollection();\n  }\n\n  /**\n   * @param {string} id\n   * @returns {object}\n   * @public\n   * @memberof MeetingInfo\n   */\n  getMeetingInfo(id) {\n    return this.meetingInfoCollection.get(id);\n  }\n\n  /**\n   * @param {string} id\n   * @param {object} info\n   * @returns {null}\n   * @public\n   * @memberof MeetingInfo\n   */\n  setMeetingInfo(id, info) {\n    this.meetingInfoCollection.set(id, info);\n  }\n\n  /**\n   * Helper to make the actual MeetingInfo request and set the meetingInfo if successful, else reject\n   * @param {Object} options\n   * @returns {Promise}\n   * @private\n   * @memberof MeetingInfo\n   */\n  requestFetchInfo(options) {\n    return this.meetingInfoRequest.fetchMeetingInfo(options).then((info) => {\n      if (info && info.body) {\n        this.setMeetingInfo(info.body.sipMeetingUri || info.body.meetingLink, info.body);\n      }\n\n      return info;\n    }).catch((error) => {\n      LoggerProxy.logger.error(`Meeting-info:index#requestFetchInfo -->  ${error} fetch meetingInfo`);\n\n      return Promise.reject(error);\n    });\n  }\n\n  /**\n   * Helper to generate the options for the MeetingInfo request\n   * @param {String} destination\n   * @param {String} type\n   * @returns {Promise}\n   * @private\n   * @memberof MeetingInfo\n   */\n  fetchInfoOptions(destination, type) {\n    return MeetingInfoUtil.generateOptions({\n      destination,\n      type,\n      webex: this.webex\n    });\n  }\n\n  /**\n   * Fetches meeting info from the server\n   * @param {String} destination one of many different types of destinations to look up info for\n   * @param {String} [type] to match up with the destination value\n   * @returns {Promise} returns a meeting info object\n   * @public\n   * @memberof MeetingInfo\n   */\n  fetchMeetingInfo(destination, type = null) {\n    return this.fetchInfoOptions(destination, type).then((options) =>\n    // fetch meeting info\n      this.requestFetchInfo(options).catch((error) => {\n      // if it failed the first time as meeting link\n        if (options.type === _MEETING_LINK_) {\n        // convert the meeting link to sip URI and retry\n          return this.requestFetchInfo(this.fetchInfoOptions(MeetingInfoUtil.convertLinkToSip(destination), _SIP_URI_));\n        }\n\n        return Promise.reject(error);\n      }));\n  }\n}\n"]}